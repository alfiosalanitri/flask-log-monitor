{% extends 'base.html' %}
{% block content %}
<h2 class="text-2xl font-semibold mb-6 text-cyan-400 tracking-wide flex items-center gap-2">
  <i data-lucide="hard-drive"></i> Settings
</h2>

<div class="w-full max-w-2xl bg-gray-900 border border-gray-800 rounded-xl p-6 shadow-sm space-y-6">
  <div>
    <h3 class="text-lg font-semibold text-cyan-400 mb-3 flex items-center gap-2">
      <i data-lucide="hard-drive"></i> Log
    </h3>

    <form id="settingsForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2" for="retention">
          Log retention period (days)
        </label>
        <input id="retention" name="retention" type="number" min="1" value="{{ retention_days }}"
               class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full outline-none focus:ring focus:ring-cyan-500">
      </div>

      <hr class="border-gray-800 my-4">

      <h3 class="text-lg font-semibold text-cyan-400 mb-3 flex items-center gap-2">
        <i data-lucide="mail"></i> SMTP (email log sending)
      </h3>

      <div class="flex items-center mb-4">
        <input id="smtp_enabled" type="checkbox" {% if smtp_enabled %}checked{% endif %} class="w-4 h-4 accent-cyan-500">
        <label for="smtp_enabled" class="ml-2 text-sm text-gray-300">Enable email log sending</label>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">SMTP Host</label>
          <input id="smtp_host" type="text" value="{{ smtp_host }}"
                 class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full border border-gray-700 focus:ring focus:ring-cyan-500">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Port</label>
          <input id="smtp_port" type="number" value="{{ smtp_port }}"
                 class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full border border-gray-700 focus:ring focus:ring-cyan-500">
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Username</label>
          <input id="smtp_user" type="text" value="{{ smtp_user }}"
                 class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full border border-gray-700 focus:ring focus:ring-cyan-500">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Password</label>
          <input id="smtp_password" type="password" placeholder="••••••••"
                 value="{{ smtp_password }}"
                 class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full border border-gray-700 focus:ring focus:ring-cyan-500">
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Sender (From)</label>
          <input id="smtp_from" type="email" value="{{ smtp_from }}"
                 class="bg-gray-800 text-gray-100 rounded-lg px-3 py-2 w-full border border-gray-700 focus:ring focus:ring-cyan-500">
        </div>

        <div class="flex items-center mt-6">
          <input id="smtp_tls" type="checkbox" {% if smtp_tls %}checked{% endif %} class="w-4 h-4 accent-cyan-500">
          <label for="smtp_tls" class="ml-2 text-sm text-gray-300">Use TLS</label>
        </div>
      </div>

      <button type="submit"
              class="bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg px-4 py-2 font-semibold w-full flex items-center justify-center gap-2">
        <i data-lucide="save"></i> Save Settings
      </button>
    </form>

    <div id="message" class="text-center text-sm mt-4 hidden"></div>
  </div>
</div>

<script>
  const form = document.getElementById('settingsForm');
  const messageBox = document.getElementById('message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const payload = {
      retention_days: document.getElementById('retention').value,
      smtp_enabled: document.getElementById('smtp_enabled').checked,
      smtp_host: document.getElementById('smtp_host').value,
      smtp_port: document.getElementById('smtp_port').value,
      smtp_user: document.getElementById('smtp_user').value,
      smtp_password: document.getElementById('smtp_password').value,
      smtp_from: document.getElementById('smtp_from').value,
      smtp_tls: document.getElementById('smtp_tls').checked
    };

    const res = await fetch('/settings', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      messageBox.innerText = 'Settings saved successfully!';
      messageBox.className = 'text-green-400 text-center text-sm mt-4';
    } else {
      messageBox.innerText = 'Error while saving settings.';
      messageBox.className = 'text-red-400 text-center text-sm mt-4';
    }
    messageBox.classList.remove('hidden');
  });
</script>
{% endblock %}
